@startuml

skinparam noteBackgroundColor LightSkyBlue
skinparam participant {
    backgroundColor Lavender
}
skinparam sequenceMessageAlign direction

title TLS exchange showing client/server access to truststores and keystores (1 way SSL - RFC5246)

participant ClientKeyStore
participant ClientTrustStore
participant Client
participant Server
participant ServerKeyStore

group TCP handshake

    Client -> Server: SYN
    Server --> Client: SYN, ACK
    Client -> Server: ACK
end

group TLS handshake

    Client -> Server: Client Hello (client-random, TLS version, ciphers, compression,extensions)
    Server -> ServerKeyStore: get my certificate (private key)
    note right of ServerKeyStore: Looks for first matching server key
    ServerKeyStore -> Server: Certificate
    Server -> Client: Server Hello (server-random, agreed cipher)
    Server -> Client: Server Certificate (certificate chain)
    Server -> Client: Server Hello Done
    Client -> ClientKeyStore: retrieve certs to trust
    ClientKeyStore -> Client: certificate list
    note left of Client: validates certificate against it's configured truststore
    note left of Client: generates a pre-master secret encrypted using server's public key
    Client -> Server: Client Key Exchange (premaster secret)
    note right of Server: descrypts pre-master key using private key
    Client -> Server: <&lock-locked>Finished
    note right of Server: creates Master secret using premaster secret, client-random, server-random

end

group Application  Use
   Client -> Server: <&lock-locked> GET /path/request
   Server -> Client: <&lock-locked> response
end

@enduml
